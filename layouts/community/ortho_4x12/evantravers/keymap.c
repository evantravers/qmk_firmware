#include QMK_KEYBOARD_H
#include "action_layer.h"
#include "evantravers.h"

extern keymap_config_t keymap_config;

#define LAYOUT_ortho_4x12_base( \
    K01, K02, K03, K04, K05, K06, K07, K08, K09, K0A, \
    K11, K12, K13, K14, K15, K16, K17, K18, K19, K1A, \
    K21, K22, K23, K24, K25, K26, K27, K28, K29, K2A  \
  ) \
  LAYOUT_ortho_4x12_wrapper( \
    _______, K01,     K02,     K03,     K04,     K05,     K06,     K07,     K08,     K09,     K0A,     _______, \
    _______, K11,     K12,     K13,     K14,     K15,     K16,     K17,     K18,     K19,     K1A,     _______, \
    _______, K21,     K22,     K23,     K24,     K25,     K26,     K27,     K28,     K29,     K2A,     _______, \
    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______ \
  )
#define LAYOUT_ortho_4x12_base_wrapper(...)       LAYOUT_ortho_4x12_base(__VA_ARGS__)

/* Qwerty
 * ,-----------------------------------------------------------------------------------.
 * | Tab  |   Q  |   W  |   E  |   R  |   T  |   Y  |   U  |   I  |   O  |   P  | Bksp |
 * |------+------+------+------+------+-------------+------+------+------+------+------|
 * | Ctrl |   A  |   S  |   D  |   F  |   G  |   H  |   J  |   K  |   L  |   ;  |  "   |
 * |------+------+------+------+------+------|------+------+------+------+------+------|
 * | Shift|   Z  |   X  |   C  |   V  |   B  |   N  |   M  |   ,  |   .  |   /  | Shift|
 * |------+------+------+------+------+------+------+------+------+------+------+------|
 * | F19  | Ctrl | Alt  | GUI  |Lower | Space| Space|Raise | GUI  | Alt  | Ctrl | SCUTS|
 * `-----------------------------------------------------------------------------------'
 */

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

  [_QWERTY] = LAYOUT_ortho_4x12_wrapper(
    QEND_L1, _________________QWERTY_L1_________________, _________________QWERTY_R1_________________, QEND_R1,
    QEND_L2, _________________QWERTY_L2_________________, _________________QWERTY_R2_________________, QEND_R2,
    QEND_L3, _________________QWERTY_L3_________________, _________________QWERTY_R3_________________, QEND_R3,
    KC_F19,  KC_LCTL, KC_LALT, KC_LGUI, KC_RSFT, LOWER,   RAISE, KC_LSFT, KC_RGUI, KC_RALT, KC_RCTL,   SHORTCUTS
  ),

  [_LOWER] = LAYOUT_ortho_4x12_wrapper(
    LEND_L1, _________________LOWER_L1__________________, _________________LOWER_R1__________________, LEND_R1,
    LEND_L2, _________________LOWER_L2__________________, _________________LOWER_R2__________________, LEND_R2,
    LEND_L3, _________________LOWER_L3__________________, _________________LOWER_R3__________________, LEND_R3,
    _______, _______, _______, _______, _______, _______, _______, _______, ______________MUSIC_______________
  ),

  [_RAISE] = LAYOUT_ortho_4x12_wrapper(
    REND_L1, _________________RAISE_L1__________________, _________________RAISE_R1__________________, REND_R1,
    REND_L2, _________________RAISE_L2__________________, _________________RAISE_R2__________________, REND_R2,
    REND_L3, _________________RAISE_L3__________________, _________________RAISE_R3__________________, REND_R3,
    _______, _______, _______, _______, _______, _______, _______, _______, ______________MUSIC_______________
  ),

  [_GAMING] = LAYOUT_ortho_4x12_wrapper(
    TAB_GAM, ___________________BLANK___________________, ___________________BLANK___________________, _______,
    _______, ___________________BLANK___________________, ___________________BLANK___________________, _______,
    _______, ___________________BLANK___________________, ___________________BLANK___________________, _______,
    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
  ),

  [_ADJUST] = LAYOUT_ortho_4x12_wrapper(
    _______, _________________ADJUST_L1_________________, _________________ADJUST_R1_________________, TO(_GAMING),
    _______, _________________ADJUST_L2_________________, _________________ADJUST_R2_________________, _______,
    _______, _________________ADJUST_L3_________________, _________________ADJUST_R3_________________, BL_STEP,
    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
  ),

  [_SHORTCUTS] = LAYOUT_ortho_4x12(
    _______, LGUI(KC_1), LGUI(KC_2), LGUI(KC_3), LGUI(KC_4), LGUI(KC_5), _______, _______, KC_7, KC_8,   KC_9,    _______,
    SW_WIND, _______,    SCRNST,     ZOOMOUT,    ZOOMIN,     _______,    _______, _______, KC_4, KC_5,   KC_6,    _______,
    _______, _______,    _______,    _______,    _______,    _______,    _______, _______, KC_1, KC_2,   KC_3,    KC_TAB,
    _______, _______,    _______,    _______,    _______,    _______,    _______, _______, KC_0, KC_DOT, _______, _______
  ),

  [_GAMING_SHORTCUTS] = LAYOUT_ortho_4x12(
    _______, KC_1,    KC_2,    KC_3,    KC_4,    KC_5,    _______, _______, _______, _______, _______, TO(_QWERTY),
    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
    _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______
  ),

};

uint32_t layer_state_set_user(uint32_t state) {
  return update_tri_layer_state(state, _LOWER, _RAISE, _ADJUST);
}

bool music_mask_user(uint16_t keycode) {
  switch (keycode) {
    case RAISE:
    case LOWER:
      return false;
    default:
      return true;
  }
};
